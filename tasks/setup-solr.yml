---
- include: install-java.yml

- name: Check solr version
  fail:
    msg: "solr-{{ solr_version }} is not exist package in mirror sites."
  when:
    - solr_version != '5.5.1'
    - solr_version != '6.0.1'
    - solr_version != '6.1.0'

- name: Check files
  stat: "path=/root/solr-{{ solr_version }}.tgz"
  register: is_file

- name: Download solr package
  get_url:
    url: "{{ solr_mirror }}/dist/lucene/solr/{{ solr_version }}/solr-{{ solr_version }}.tgz"
    dest: "{{ solr_work }}/solr-{{ solr_version }}.tgz"
  when:
    - is_file.stat.exists == False
    
- name: Unarchive solr package
  unarchive:
    src: "{{ solr_work }}/solr-{{ solr_version }}.tgz"
    dest: "{{ solr_work }}"

- name: Installing solr
  shell: "bin/install_solr_service.sh ../solr-{{ solr_version }}.tgz"
  args:
    chdir: "{{ solr_work }}/solr-{{ solr_version }}"
    creates: "/var/solr"

# Create core
- include: create-solr-core.yml
  when:
    - "{{ solr_create_core }} == True"

- name: Restart solr service
  service:
    name: solr
    state: restarted
